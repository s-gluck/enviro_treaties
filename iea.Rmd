---
title: "International Environmental Treaties"
author: "Thuy Nguyen"
date: "February 7, 2020"
output: html_document
---

Hi reviewers! Please allow me to work on this for 2 more days (Thurs and Fri). There's still too many things I need to figure out.  I'll let you know when I'm more ready. Thank you for your understanding. 


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(rio)
library(here)
library(tidyverse)
library(ggplot2)
library(gghighlight)
library(colorblindr)

```


```{r load data}
data <- import(here("data", "iea_measonly.dta"))

# clean data
data <- data %>% 
  select("tsig_yr", "subject_group", "region_continent", "orgauspices") %>% 
  filter(subject_group != "Uncoded")  %>% 
  filter(subject_group != "") 

```


```{r}

data %>% 
  count(subject_group) %>% 
  ggplot(aes(fct_reorder(subject_group), n), fill = subject_group) +
           geom_bar(position = "dodge") +
  facet_wrap(~agreement_type) +
  coord_flip() +
  guides(fill = FALSE) +
  labs(
    x = "Type of treaty group",
    y = "Number of treaties",
    title = "Type of treaties by subjects"
  )
```


``` {r}
data %>% 
  
  filter(region_continent == c("Africa", "Asia", "Central America", 
                              "Europe", "North America", "Oceania",
                              "South America")) %>% 
  # arrange(tsig_yr) %>% 
  # group_by(subject_group) %>% 
  ggplot(aes(subject_group, fill = subject_group)) +
  geom_bar(position = "dodge") +
  coord_flip() +
  guides(fill = FALSE) +
  facet_wrap(~region_continent) + 
  scale_color_OkabeIto() +
  labs(
    x = "Type of treaty group",
    y = "Number of treaty",
    title = "Type of treaty signed by continent"
  )

# need to get the map somewhere

```

# From signature to entry into force
Some signed treaties never got ratified, which is coded as a very large value in `tsig_yr`. We'll have diffrent visualization for group of treaties that were ratified and those were not. 

```{r}

dp3 <- data %>% 
  select("subject_group", "tsig_yr", "teif_yr") %>% 
  mutate(year_gap = teif_yr - tsig_yr) 

# subset of data that the gap is > 20 years (not ratified)

dp3_non <- subset(dp3, year_gap > 20) %>% 
  count(subject_group) %>% 
  mutate(percent = n/sum(n)*100) %>% 
  ggplot(aes(fct_reorder(subject_group,percent), percent)) +
    geom_col() +
    coord_flip() +
  labs(
    x = "Type of treaty group",
    y = "Percent",
    title = "Treaties signed but not ratified",
    caption = "Data from Ronald B. Mitchell. 2002-2020. International Environmental Agreements Database Project (Version 2020.1).
Available at: http://iea.uoregon.edu/ Date accessed: 26 February 2020"
  )

#subset of data that the year gap is < 20 years (ratified)
# Summarise table of average number of years gap between signature year and ratification year of each subject-group

dp_rat <- dp3 %>% 
  filter(year_gap < 20) %>% 
  arrange(tsig_yr)
  group_by(subject_group, year_gap) %>% 
  summarise(mean = mean(year_gap), na.rm = TRUE) # how to calculate mean of year-gap for each group?

library(gt)
dp_rat %>% 
  gt()

  
```


# Organization Auspices

What kind of treaty are more likely to be under an organization auspices?
```{r}

data %>% 
  group_by(subject_group, orgauspices) %>% 
  count(orgauspices) %>% # not sure what the n is
  ggplot(aes())
  


```

